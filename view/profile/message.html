
<html lang='fa-IR'>

<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='icon' href='../../../files/logo.webp' alt='لوگو نیک پی' size='16x16'>
    </link>
    <link rel="stylesheet" href="../css/style.css">
    <title>پیام رسان</title>
    <script src='/library/jquery/3.3.1.min.js'></script>
    <script src='../js/main.js'></script>
    <script src='/library/jquery/inputmask/bundle/3.1.62.js'></script>
</head>
<style>
    main{
		display:flex;
		height: calc(100vh - 55px);
	}
    	/* scrollbar properties */
	#ContactScroll::-webkit-scrollbar {
		width: 10px;
	}
	#ContactScroll::-webkit-scrollbar-track {
		box-shadow: inset 0 0 5px black; 
		border-radius: 10px;
	}
	#ContactScroll::-webkit-scrollbar-thumb {
		background: midnightblue; 
		border-radius: 10px;
	}
	#ContactScroll::-webkit-scrollbar-thumb:hover {
		background: blue; 
	}
</style>
<body onload="GoToBottom();select_textarea();">

    <div class='navbar'>
        <div style='width:160px;display:flex;float:left;color: white;position:relative;height:55px;'
            onclick='ToggleNavBarMenu();'>
            <a style='display:none;width:32px;height:32px;margin:auto;' href='/membership/notification/'>
                <img style='width: 100%;margin-top: 5px;' src='/library/images/notification.webp'>
                <div id='NotificationCounter'>
                </div>
                </img>
            </a>
            <div
                style='width:calc(100% - 32px);height:32px;display:flex;margin:auto;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;'>
                <div style='margin: auto;'>admin admin</div>
            </div>
            <div style='width:32px;height:32px;margin:auto 5px;'>
                <img src='/library/images/user_logo_white.webp' style='width:30px;height:30px;'></img>
            </div>
        </div>
        <div id='HeaderImage' style='display:none;'>
            <a href='./?logout=on'>
                <img src='/library/images/logout_white.webp'></img>
            </a>
            <a href='/membership/notification/'>
                <img src='/library/images/notification.webp'>
                <div id='NotificationCounter'>
                    اعلانات
                    (
                    100+ )
                </div>
                </img>
            </a>
        </div>
        <div id='header_hamburger_button' style='' onclick='ToggleHeaderSideMenu();'>
            <div style=''></div>
            <div style=''></div>
            <div style=''></div>
        </div>
        <div id='header_bigsize'>
            <div class='dropdown'>
                <button class='dropbtn'>
                    <a>منو عمومی</a>
                    <i class='fa fa-caret-down'></i>
                </button>
                <div class='dropdown-content'>
                    <div class='' id=''>
                        <a href='/maintenance/external/paymentservice/'>تعمیرگاه سانیار سرویس</a>
                    </div>
                </div>
            </div>
            <div class='dropdown'>
                <button class='dropbtn'>
                    <a>منو</a>
                    <i class='fa fa-caret-down'></i>
                </button>
                <div class='dropdown-content'>
                    <div class='' id=''><a href='../../../'>منو</a></div>
                </div>
                <div class='dropdown-content'>
                    <div class='' id=''><a href='../../../membership/'>خانه</a><a
                            href='../../../membership/profile/'>پروفایل</a><a
                            href='../../../library/logout.php'>خروج</a><a
                            href='../../../membership/bank/PaymentTerminal/V1/'>کارتخوان</a><a
                            href='../../../membership/tool/sidebyside/'>چسباندن عکس کنار هم</a><a
                            href='../../../membership/bank/PaymentTerminal/WebServices/Passargad/Query/'>استعلام سریال
                        </a><a href='../../../membership/bank/AutomaticTellerMachine/V1/'>خودپرداز</a><a
                            href='../../../Bank/Registry/'>رجیستر پذیرنده</a><a
                            href='../../../membership/bank/PaymentTerminal/Export/Terminal/Export/index.php?Acceptor=off'>خروجی
                            ترمینال</a><a href='../../../membership/maintenance/'>تعمیرات کارتخوان</a></div>
                </div>
            </div>
        </div>
    </div>

    <section id='navbar2' style=''>
        <div id='navbar2_content' style=''>
            <div>
                <a href='/membership/'>داشبورد</a>
            </div>
            <div>
                <a href='/membership/profile/'>پروفایل</a>
            </div>
            <div>
                <a style='' href='/membership/message/messenger/'>
                    پیام ها
                    (
                    0 )
                </a>
            </div>
            <div>
                <a style='' href='/membership/notification/'>
                    اعلانات
                    (
                    100+ )
                </a>
            </div>
            <div><a href='/membership/admin/'>ادمین</a></div>
            <div><a href='./?logout=on'>خروج</a></div>
        </div>
    </section>

    <section id='header_smallsize'>

        <div class='header_smallsize_topic'>
            <a>منو</a>
        </div>

        <div style='width:80%;height:1px;margin: 3px auto;background-color:#333333;'></div>

        <div class='header_smallsize_menu'>
            <a href='../../../'>منو</a>
        </div>

        <div class='header_smallsize_menu'>
            <a href='../../../membership/'>خانه</a>
        </div>

        <div class='header_smallsize_menu'>
            <a href='../../../membership/profile/'>پروفایل</a>
        </div>

        <div class='header_smallsize_menu'>
            <a href='../../../library/logout.php'>خروج</a>
        </div>

        <div class='header_smallsize_menu'>
            <a href='../../../membership/bank/PaymentTerminal/V1/'>کارتخوان</a>
        </div>

        <div class='header_smallsize_menu'>
            <a href='../../../membership/tool/sidebyside/'>چسباندن عکس کنار هم</a>
        </div>

        <div class='header_smallsize_menu'>
            <a href='../../../membership/bank/PaymentTerminal/WebServices/Passargad/Query/'>استعلام سریال </a>
        </div>

        <div class='header_smallsize_menu'>
            <a href='../../../membership/bank/AutomaticTellerMachine/V1/'>خودپرداز</a>
        </div>

        <div class='header_smallsize_menu'>
            <a href='../../../Bank/Registry/'>رجیستر پذیرنده</a>
        </div>

        <div class='header_smallsize_menu'>
            <a href='../../../membership/bank/PaymentTerminal/Export/Terminal/Export/index.php?Acceptor=off'>خروجی
                ترمینال</a>
        </div>

        <div class='header_smallsize_menu'>
            <a href='../../../membership/maintenance/'>تعمیرات کارتخوان</a>
        </div>
    </section>
    <style>
        @media screen and (max-width: 768px) {
            main {
                display: flex;
                flex-direction: row-reverse;
            }
        }

        @media screen and (min-width: 768px) {
            main {
                display: flex;
                flex-direction: row;
            }
        }
    </style>
    <main>
        <section id="ChatArea">
            <div id='chat_quick_menu'>
                <div style='margin: 0 5px;'>
                </div>
                <a href='./.' style='margin-right: auto;'>
                    <button id='ReturnFormButton' style='float: left;width:32px;height:32px;'>
                        <img src='/membership/navigation/images/return.webp' style='width:100%;'></img>
                    </button>
                </a>
            </div>
            <!-- <form action="modify.php" method="POST" enctype="multipart/form-data" > -->
            <form id='imgup' name='imgup' enctype="multipart/form-data" style='position:relative;width:100%;'>
            </form>
        </section>
        <section id='ContactScroll' style=''>
            <div class='SearchForm' style='width: 100%;display: flex;margin: 10px auto;'>
                <form style='width: calc(100% - 64px);margin: 0 auto;' action='' method='GET'>
                    <input placeholder='جستجو' id="myInput" onkeyup="SearchChat()" class='SearchInput' name='Search'
                        style='font-size:14px;text-indent: 10px;background-color: #f1f1f1;width: 90%;border-radius: 50px;margin:0 auto;'
                        autocomplete='off'></input>
                </form>
                <form action='Contact' method='GET'
                    style='background-color: white;width:28px;height:28px;margin: auto;'>
                    <button type='submit' class='StandardButton'
                        style=';background-image:url("/library/images/user_logo_265X265.webp");'></button>
                </form>
            </div>
            <div id='testsort' style='width:100%;overflow-y: scroll;height: 100%;'>
            </div>
        </section>
        <style>
            input[type="file"] {
                display: none;
            }
        </style>
        <input id="file-upload" type="file" />
    </main>
</body>
<script>
    function changementofChatToolbar() {
        var voice_send_button = document.getElementById('voice_send_button');
        var chat_send_button = document.getElementById('chat_send_button');
        var Message = document.getElementById('Message');
        //--------------- اضافه کردن فضای تایپ -----------------//
        // تعداد حرف در پیام
        var Messagecharacter = Message.value.length;

        // اندازه نوشتار
        // 5 ضریب عرض است که باید از پیکسل کم شود
        var MessageFontSize = ((Message.style.fontSize).replace("px", ""));

        // عرض فضای برای نوشتن پیام
        var MessageBoxWidth = Message.clientWidth;

        // ارتفاع فضای برای نوشتن پیام
        var MessageBoxHeight = Message.clientHeight;

        // محاسبه تعداد کاراکتر مجاز در فضای موجود
        var totalletterlimit = (MessageBoxWidth / (MessageFontSize - 5));

        // گرد کردن اعداد اعشار رو به پایین
        var totalletterlimitfloor = Math.floor(totalletterlimit);


        // اضافه کردن یک خط به بخش چت اگر تعداد کاراکتر بیش از یک خط شد
        if (Messagecharacter > 0) {
            if (((Messagecharacter / totalletterlimitfloor) - Math.floor(Messagecharacter / totalletterlimitfloor)) === 0) {
                //(n - Math.floor(n)) === 0 فرمول عدد کامل 
                console.log('KAMEL');
                Message.style.height = Number(MessageBoxHeight) + Number(MessageFontSize) + 5;
            }
        } else if (Messagecharacter === 0) {
            Message.style.height = '46px';
        }

        if (Messagecharacter > 0) {
            voice_send_button.style.display = 'none';
            chat_send_button.style.display = 'block';
        } else {
            voice_send_button.style.display = 'block';
            chat_send_button.style.display = 'none';
        }

    }

    function SearchChat() {
        var input, filter, ul, li, a, i, txtValue;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        ul = document.getElementById("testsort");
        li = ul.getElementsByTagName("form");
        for (i = 0; i < li.length; i++) {
            a = li[i].getElementsByTagName("button")[0];
            txtValue = a.textContent || a.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                li[i].style.display = "";
            } else {
                li[i].style.display = "none";
            }
        }
    }


    /*
        function GoToBottom() {
            window.scrollTo(0, document.body.scrollHeight);
        }*/
    function GoToBottom() {
        document.getElementById('end').scrollIntoView();
    }


    function highlight_message(id_message_replied) {
        console.log(id_message_replied);
        var the_message_selected = document.getElementById(id_message_replied);
        the_message_selected.style.filter = 'brightness(1)';
        setTimeout(function () {
            the_message_selected.style.filter = 'brightness(0.75)';
        }, 1000);

    }
    //جواب دادن به یک پیام
    function getvalue(clicked_id, message) {
        console.log(clicked_id);
        var the_id_clicked = document.getElementById(clicked_id);
        var ReplyArea = document.getElementById('ReplyArea');
        var reply_text = document.getElementById('reply_text');
        var color = the_id_clicked.style.color;
        console.log(color);
        if (color === 'black' || !color) {
            //the_id_clicked.style.color = 'red';
            document.getElementById("Reply").value = clicked_id;
            document.getElementById("ReplyArea").style.display = 'flex';
            document.getElementById("reply_text").value = message;
        } else {
            //the_id_clicked.style.color = 'black';
            document.getElementById("Reply").value = "";
            document.getElementById("ReplyArea").style.display = 'none';
            document.getElementById("reply_text").value = '';
        }
    }

    // لغو پاسخ به پیام (لغو ریپلای)
    function cancelreply() {
        document.getElementById('Reply').value = '';
        document.getElementById("ReplyArea").style.display = 'none';
        document.getElementById("reply_text").value = '';
    }


    //برای اینکه با enter ارسال بشود و با entershift یک خط پایین بیاید
    var input = document.getElementById("Message");
    // Execute a function when the user presses a key on the keyboard
    input.addEventListener("keypress", function (event) {
        // If the user presses the "Enter" key on the keyboard
        if (event.key === "Enter") {

            if (event.shiftKey) {
                //console.log('shift enter was pressed');
            } else {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                document.getElementById("chat_send_button").click();
            }
        }
    });

    //ارسال متغیر های مختلف
    $(document).ready(function (e) {
        $("#imgup").on('submit', (function (e) {
            e.preventDefault();
            var Receiver = $('#Receiver').val();
            var Message = $('#Message').val();
            var Reply = $('#Reply').val();
            var file11 = $('#file11');
            // Attach file
            var formData = new FormData(this);
            //برای انتخاب کردن یک آیدی خاص در فرم از append استفاده می کنیم
            // بعد از این اولین گزینه در واقع نام ارسالی و دومی آیدی مربوط به ارسال است
            formData.append('file11', file11);
            //formData.append('name11', name11);
            formData.append('Receiver', Receiver);
            formData.append('Message', Message);
            formData.append('Reply', Reply);
            $.ajax({
                url: "modify.php",
                type: "POST",
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: function (data) {
                    $(".result").html(data);
                }//,
                //	error: function() 
                //	{
                //	} 	        
            });
        }));
    });
    // Dealing with Input width
    let el = document.querySelector(".input-wrap .input");
    let widthMachine = document.querySelector(".input-wrap .width-machine");
    el.addEventListener("keyup", () => {
        widthMachine.innerHTML = el.value;
    });

    // Dealing with Textarea Height
    function calcHeight(value) {
        let numberOfLineBreaks = (value.match(/\n/g) || []).length;
        // min-height + lines x line-height + padding + border
        let newHeight = 20 + numberOfLineBreaks * 20 + 12 + 2;
        return newHeight;
    }

    let textarea = document.querySelector(".resize-ta");
    textarea.addEventListener("keyup", () => {
        textarea.style.height = calcHeight(textarea.value) + "px";
    });
    function select_textarea() {
        document.getElementById("Message").select();
    }
</script>

</html>